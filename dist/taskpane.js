/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){var e,t,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(n,o,a,i){var c=o&&o.prototype instanceof u?o:u,l=Object.create(c.prototype);return r(l,"_invoke",function(n,r,o){var a,i,c,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,c=e,d.n=n,s}};function p(n,r){for(i=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,y=a[2];n>3?(o=y===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<y&&(o=n<3||a[0]>r||r>y)&&(a[4]=n,a[5]=r,d.n=y,i=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,y){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,y),i=l,c=y;(t=i<2?e:c)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,c)):d.n=c:d.v=c);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=d.n<0)?c:n.call(r,d))!==s)break}catch(t){a=e,i=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,a,i),!0),l}var s={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(r(t={},a,function(){return this}),t),p=f.prototype=u.prototype=Object.create(d);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,r(p,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,i,"GeneratorFunction"),r(p),r(p,i,"Generator"),r(p,a,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m:y}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,t,n,o){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,o)}function o(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function c(e){o(i,r,a,c,s,"next",e)}function s(e){o(i,r,a,c,s,"throw",e)}c(void 0)})}}var i="inboxAgent.attributes",c="AportioAttributes",s=["Product","Support","Sales","Billing"],u=["Negative","Neutral","Positive"],l="24324ddadasadasdasdawqeqwewewqqwewqzx",f="L56bxb9LUif8aU5BzyOSRzaEaspkEU35",d="AknPv0yJCw1EmIFreyoCaQuA1UVbUlGUqROvZtulJ71D6SB12sjDTncf6KZp2Jo",p='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width,initial-scale=1">\n  <title></title>\n  <style>\n    body, p {font-family: Arial, Helvetica, sans-serif;}\n  </style>\n</head>\n<body>\n  {{content}}\n</body>\n</html>';function y(){var e;return null===(e=Office.context)||void 0===e||null===(e=e.mailbox)||void 0===e?void 0:e.item}function m(e){var t=document.getElementById("statusText");t&&(t.textContent=e)}function v(e){var t=document.getElementById("summary");t&&(t.textContent=e)}function g(e){var t=document.getElementById("suggestedActions");t&&(t.innerHTML="",e&&0!==e.length?e.forEach(function(e){var n=document.createElement("span");n.className="chip",n.textContent=e,t.appendChild(n)}):t.textContent="No suggested actions.")}function b(e){var t=document.getElementById("suggestedActions");t&&(t.textContent=e)}function h(e){return e?Array.isArray(e)?e.map(function(e){return String(e)}).filter(Boolean):"string"==typeof e?e.split(/[,;]\s*/g).map(function(e){return e.trim()}).filter(Boolean):[]:[]}function A(e){var t=e||{},n=t.category,r=t.sentiment,o=t.priority,a=t.assignee;void 0!==n&&(document.getElementById("category").value=n||""),void 0!==r&&(document.getElementById("sentiment").value=r||""),void 0!==o&&(document.getElementById("priority").value=o||""),void 0!==a&&(document.getElementById("assignee").value=a||"")}function w(e,t){if(!t)return"";var n=document.getElementById(e);if(!n)return t;var r=String(t).toLowerCase(),o=Array.from(n.options).find(function(e){return String(e.value).toLowerCase()===r});return o?o.value:t}function S(e,t){if(t){var n=document.getElementById(e);if(n&&!Array.from(n.options).some(function(e){return e.value===t})){var r=document.createElement("option");r.value=t,r.textContent=t,n.appendChild(r)}}}function k(e){var t=w("category",e.category||""),n=w("sentiment",e.sentiment||""),r=w("priority",e.priority||""),o=e.assignee||"";S("category",t),S("sentiment",n),S("priority",r),A({category:t,sentiment:n,priority:r,assignee:o})}function E(){return{category:document.getElementById("category").value,sentiment:document.getElementById("sentiment").value,priority:document.getElementById("priority").value,assignee:document.getElementById("assignee").value.trim()}}function O(e){var t=[];return e.category&&t.push("Category: ".concat(e.category)),e.sentiment&&t.push("Sentiment: ".concat(e.sentiment)),e.priority&&t.push("Priority: ".concat(e.priority)),e.assignee&&t.push("Assignee: ".concat(e.assignee)),t.length?t.join(" | "):"No attributes set"}function I(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function T(e,t){if("processing"===e){var n=O(t),r="No attributes set"!==n?"<p>".concat(I(n),"</p>"):"",o="<p>Hi</p><p>I am working on this and will reply within 3 business days.</p>".concat(r,"<p>Thanks</p>");return p.replace("{{content}}",o).replace("{{footer}}","")}return function(e){var t=O(e),n="No attributes set"!==t?"<p>".concat(I(t),"</p>"):"",r="<p>Hi</p><p>This is a template reply.</p>".concat(n,"<p>Thanks</p>");return p.replace("{{content}}",r).replace("{{footer}}","")}(t)}function C(){var e=y();return null!=e&&e.itemId?"".concat("inboxAgent.local.").concat(e.itemId):null}function j(e){var t=C();t&&localStorage.setItem(t,JSON.stringify(e))}function B(){var e=C();if(!e)return null;var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}}function R(){var e=C();e&&localStorage.removeItem(e)}function x(e){return new Promise(function(t,n){var r=y();r?r.loadCustomPropertiesAsync(function(r){r.status===Office.AsyncResultStatus.Succeeded?e(r.value,t,n):n(r.error||new Error("Unable to load custom properties."))}):n(new Error("Mailbox item is not available."))})}function P(){return x(function(e,t,n){try{var r=e.get(i);if(!r)return void t(null);t(JSON.parse(r))}catch(e){n(e)}})}function N(e){return x(function(t,n,r){t.set(i,JSON.stringify(e)),t.saveAsync(function(e){e.status!==Office.AsyncResultStatus.Succeeded?r(e.error||new Error("Unable to save attributes.")):n()})})}function U(){return x(function(e,t,n){try{"function"==typeof e.remove?e.remove(i):e.set(i,"null"),e.saveAsync(function(e){e.status!==Office.AsyncResultStatus.Succeeded?n(e.error||new Error("Unable to clear attributes.")):t()})}catch(e){n(e)}})}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"informationalMessage";return new Promise(function(n){var r,o=y();if(null!=o&&null!==(r=o.notificationMessages)&&void 0!==r&&r.replaceAsync){var a={type:t,message:e};"informationalMessage"===t&&(a.icon="icon16",a.persistent=!0);try{o.notificationMessages.replaceAsync(c,a,function(){return n()})}catch(e){console.warn("Notification not shown (ignored):",e),n()}}else n()})}function F(e,t){if(e){var n=e.querySelector('option[value=""]');if(e.innerHTML="",n)e.appendChild(n);else{var r=document.createElement("option");r.value="",r.textContent="—",e.appendChild(r)}t.forEach(function(t){var n=document.createElement("option");n.value=t,n.textContent=t,e.appendChild(n)})}}function M(e,t){if(e){var n=e.querySelector('option[value=""]');if(e.innerHTML="",n)e.appendChild(n);else{var r=document.createElement("option");r.value="",r.textContent="—",e.appendChild(r)}t.forEach(function(t){var n=document.createElement("option");n.value=t.value,n.textContent=t.label,e.appendChild(n)})}}function z(){return{baseUrl:"https://congress-library-prayer-international.trycloudflare.com",token:"GYIVwvd7MXGLTJVjAdySzPkI1yq5606LzPcnjqdRBwHsKxBUyrhwjIVDnkyRNlh"}}function q(e){return e?"".concat(e.replace(/\/+$/,"")).concat("/status"):""}function L(e){var t;return Array.isArray(null==e||null===(t=e.data)||void 0===t?void 0:t.reporter)?e.data.reporter:[]}function H(e){var t=document.getElementById("latestEmailSummary");t&&(t.textContent=e||"—")}function G(e){if(!e)return"—";var t=(null==e?void 0:e.subject)||(null==e?void 0:e.email_subject)||(null==e?void 0:e.title)||"",n=function(e){if(!e)return"";if("string"==typeof e)return e;var t=e.name||e.display_name||e.full_name||"",n=e.email||e.address||e.email_address||"";return t&&n?"".concat(t," <").concat(n,">"):t||n||""}((null==e?void 0:e.from)||(null==e?void 0:e.from_address)||(null==e?void 0:e.sender)||(null==e?void 0:e.email_from)),r=function(e){if(!e)return"";var t=new Date(e);return Number.isNaN(t.getTime())?String(e):t.toLocaleString()}((null==e?void 0:e.date)||(null==e?void 0:e.sent_at)||(null==e?void 0:e.created_at)||(null==e?void 0:e.received_at)),o=[];return t&&o.push(t),n&&o.push("from ".concat(n)),r&&o.push(r),o.length?o.join(" · "):"—"}function J(e){return ce(null==e?void 0:e.from)}function D(e){var t=(null==e?void 0:e.internetMessageId)||(null==e?void 0:e.messageId)||"";return String(t||"")}function V(e){var t=(null==e?void 0:e.dateTimeSent)||(null==e?void 0:e.dateTimeCreated)||(new Date).toISOString();try{return new Date(t).toISOString()}catch(e){return(new Date).toISOString()}}function K(){return(K=a(n().m(function e(){var t,r,o,a,i,c,s,u,l,f;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if((t=document.getElementById("reportEmailsSelect"))&&M(t,[]),r=z(),o=r.baseUrl,a=r.token,o&&a){e.n=1;break}return m("reports: base url and token required"),e.a(2);case 1:return m("reports: loading..."),i=q(o),e.p=2,e.n=3,fetch(i,{headers:{Accept:"application/json",Authorization:"Bearer ".concat(a)}});case 3:if((c=e.v).ok){e.n=4;break}return m("reports: request failed (".concat(c.status,")")),e.a(2);case 4:return e.n=5,c.json();case 5:s=e.v,u=L(s),l=u.map(function(e,t){var n=String(t+1);return{value:String(n),label:String(e)}}),t&&M(t,l),m("reports: loaded ".concat(u.length)),e.n=7;break;case 6:e.p=6,f=e.v,console.error("Report fetch failed",f),m("reports: request error");case 7:return e.a(2)}},e,null,[[2,6]])}))).apply(this,arguments)}function $(e,t){return new Promise(function(n,r){var o,a=y();null!=a&&null!==(o=a.categories)&&void 0!==o&&o.getAsync?a.categories.getAsync(function(o){if(o.status===Office.AsyncResultStatus.Succeeded){var i=function(e){return String(e||"").trim().toLowerCase()},c=(o.value||[]).map(function(e){return String(e||"")}),s=new Set(e.filter(Boolean).map(i)),u=new Set(t.map(i)),l=c.filter(function(e){var t=i(e);return!u.has(t)||s.has(t)}),f=c.filter(function(e){return u.has(i(e))&&!s.has(i(e))}),d=e.filter(function(e){return e&&!c.some(function(t){return i(t)===i(e)})}),p=function(){return n()},y=function(){d.length?a.categories.addAsync(d,function(e){e.status===Office.AsyncResultStatus.Succeeded?p():r(e.error||new Error("Unable to add category."))}):p()};if(f.length){var m=function(){a.categories.removeAsync(f,function(e){e.status===Office.AsyncResultStatus.Succeeded?y():r(e.error||new Error("Unable to remove categories."))})};"function"!=typeof a.categories.setAsync?m():a.categories.setAsync(l,function(e){e.status!==Office.AsyncResultStatus.Succeeded?m():n()})}else y()}else r(o.error||new Error("Unable to read categories."))}):n()})}function Y(){return new Promise(function(e,t){var n,r=y();null!=r&&null!==(n=r.categories)&&void 0!==n&&n.getAsync?r.categories.getAsync(function(n){if(n.status===Office.AsyncResultStatus.Succeeded){var o=(n.value||[]).map(function(e){return String(e||"").trim()}).filter(Boolean);o.length?r.categories.removeAsync(o,function(n){n.status!==Office.AsyncResultStatus.Succeeded?"function"!=typeof r.categories.setAsync?t(n.error||new Error("Unable to clear categories.")):r.categories.setAsync([],function(n){n.status!==Office.AsyncResultStatus.Succeeded?t(n.error||new Error("Unable to clear categories.")):e()}):e()}):e()}else t(n.error||new Error("Unable to read categories."))}):e()})}function Z(e){return new Promise(function(t,n){var r,o=y();if(function(e){var t;return Boolean(null==e||null===(t=e.body)||void 0===t?void 0:t.setAsync)}(o))if(null!=o&&null!==(r=o.importance)&&void 0!==r&&r.setAsync){var a=e?e.toLowerCase():"normal";o.importance.setAsync(a,function(e){e.status!==Office.AsyncResultStatus.Succeeded?n(e.error||new Error("Unable to set importance.")):t()})}else t();else t()})}function Q(e){if(!e)return!1;var t=String(e.message||"").toLowerCase();return 5e3===e.code||t.includes("not supported")}function W(){return new Promise(function(e){var t=y();if(null!=t&&t.notificationMessages){var n=t.notificationMessages,r=function(){if("function"==typeof n.replaceAsync)try{n.replaceAsync(c,{type:"informationalMessage",message:""},function(){return e()})}catch(t){console.warn("Notification clear fallback failed (ignored):",t),e()}else e()};"function"!=typeof n.removeAsync?r():n.removeAsync(c,function(t){(null==t?void 0:t.status)!==Office.AsyncResultStatus.Succeeded?r():e()})}else e()})}function X(){return ee.apply(this,arguments)}function ee(){return ee=a(n().m(function e(){var t,r,o,a,i,c,s,l,f,d,p=arguments;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=(t=p.length>0&&void 0!==p[0]?p[0]:{}).preserveForm,o=void 0!==r&&r,a=t.allowLocalFallback,i=void 0===a||a,c=t.notify,s=void 0===c||c,null!=(l=y())&&l.subject?v("Analyzing: ".concat(l.subject)):v("Analyzing..."),b("Analyzing..."),de(),e.p=1,F(document.getElementById("sentiment"),u),m("loading saved attributes..."),e.n=2,P();case 2:if((f=e.v)||!i){e.n=3;break}if(!(f=B())){e.n=3;break}if(m("loaded local attributes"),!s){e.n=3;break}return e.n=3,_("Restored local attributes • ".concat(O(f)));case 3:if(!f){e.n=5;break}if(o||A(f),m("loaded saved attributes"),!s){e.n=4;break}return e.n=4,_("Restored attributes • ".concat(O(f)));case 4:e.n=6;break;case 5:m("ready");case 6:e.n=8;break;case 7:e.p=7,d=e.v,console.error("Failed to load saved attributes",d),m("ready (attributes not loaded)");case 8:return e.a(2)}},e,null,[[1,7]])})),ee.apply(this,arguments)}function te(){return(te=a(n().m(function e(){var t,r,o,a,i,c,u,l,f,d;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=E(),m("applying attributes..."),e.p=1,r=!0,e.p=2,e.n=3,N(t);case 3:e.n=6;break;case 4:if(e.p=4,!Q(u=e.v)){e.n=5;break}r=!1,e.n=6;break;case 5:throw u;case 6:return o=[],t.category&&o.push(t.category),a=s,e.p=7,e.n=8,$(o,a);case 8:e.n=10;break;case 9:if(e.p=9,Q(l=e.v)){e.n=10;break}throw l;case 10:return e.p=10,e.n=11,Z(t.priority);case 11:e.n=13;break;case 12:return e.p=12,f=e.v,console.warn("Failed to set importance.",f),e.n=13,_("Priority not updated in Outlook (importance update failed).","errorMessage");case 13:return j(t),i=O(t),m(r?"attributes saved to this item":"attributes saved locally (mailbox properties not supported)"),e.n=14,_("Aportio saved • ".concat(i));case 14:e.n=16;break;case 15:return e.p=15,d=e.v,console.error("Failed to apply attributes",d),j(t),c=d&&d.message?d.message:String(d),m("saved locally (server save failed)"),e.n=16,_("Saved locally only (could not save to mailbox): ".concat(c),"errorMessage");case 16:return e.a(2)}},e,null,[[10,12],[7,9],[2,4],[1,15]])}))).apply(this,arguments)}function ne(){return(ne=a(n().m(function e(){var t,r,o,a,i;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return m("clearing attributes..."),t=[],r=function(e,n){t.push(e),console.error("Failed to clear ".concat(e),n)},e.p=1,e.n=2,U();case 2:e.n=4;break;case 3:e.p=3,o=e.v,r("stored attributes",o);case 4:try{R()}catch(e){r("local attributes",e)}return e.p=5,e.n=6,Y();case 6:e.n=8;break;case 7:e.p=7,a=e.v,r("categories",a);case 8:return e.p=8,e.n=9,Z("");case 9:e.n=11;break;case 10:e.p=10,i=e.v,r("importance",i);case 11:return A({category:"",sentiment:"",priority:"",assignee:""}),e.n=12,W();case 12:t.length?m("clear done (failed: ".concat(t.join(", "),")")):m("attributes cleared");case 13:return e.a(2)}},e,null,[[8,10],[5,7],[1,3]])}))).apply(this,arguments)}function re(){return new Promise(function(e){var t,n=y();null!=n&&null!==(t=n.body)&&void 0!==t&&t.getAsync?n.body.getAsync(Office.CoercionType.Text,function(t){t.status!==Office.AsyncResultStatus.Succeeded?e(""):e(t.value||"")}):e("")})}function oe(){return new Promise(function(e){var t,n=y();null!=n&&null!==(t=n.body)&&void 0!==t&&t.getAsync?n.body.getAsync(Office.CoercionType.Html,function(t){t.status!==Office.AsyncResultStatus.Succeeded?e(""):e(t.value||"")}):e("")})}function ae(e){return"".concat("https://alignment-usage-prescribed-airline.trycloudflare.com".replace(/\/+$/,"")).concat(e)}function ie(e,t){return e&&t?"Basic ".concat(btoa("".concat(e,":").concat(t))):""}function ce(e){return e?"string"==typeof e?e:e.emailAddress||e.address||e.name||"":""}function se(e){return e?e.map(function(e){return ce(e)}).map(function(e){return String(e||"").trim()}).filter(Boolean).join(", "):""}function ue(e,t){return new Promise(function(n){var r=null==e?void 0:e[t];r?Array.isArray(r)?n(se(r)):"function"!=typeof r.getAsync?n(""):r.getAsync(function(e){e.status!==Office.AsyncResultStatus.Succeeded?n(""):n(se(e.value||[]))}):n("")})}function le(){return(le=a(n().m(function e(){var t,r,o,a,i;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:e.n=1;break;case 1:if(t=ie(f,d)){e.n=2;break}return m("emails: API key missing"),e.a(2);case 2:return m("emails: fetching..."),e.p=3,e.n=4,fetch("https://alignment-usage-prescribed-airline.trycloudflare.com/api/v2/reports/report_emails/?limit=50&offset=0&ordering=desc",{method:"GET",headers:{Authorization:t}});case 4:if((r=e.v).ok){e.n=5;break}return m("emails failed (".concat(r.status,")")),e.a(2);case 5:return e.n=6,r.json();case 6:return o=e.v,a=Array.isArray(null==o?void 0:o.results)?o.results.length:"",H(G(Array.isArray(null==o?void 0:o.results)?o.results[0]:null)),m(a?"emails ok (fetched: ".concat(a,")"):"emails ok"),e.n=7,_("Emails fetched","informationalMessage");case 7:e.n=9;break;case 8:e.p=8,i=e.v,console.error("Email fetch failed",i),H("—"),m("emails failed (network error)");case 9:return e.a(2)}},e,null,[[3,8]])}))).apply(this,arguments)}function fe(){return(fe=a(n().m(function t(){var r,o,a,i,c,s,u,l,p,v,g,b,h,A;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r=y()){t.n=1;break}return m("sync: no item selected"),t.a(2);case 1:t.n=2;break;case 2:if(o=ie(f,d)){t.n=3;break}return m("sync: API key missing"),t.a(2);case 3:return m("sync: sending to InboxAgent..."),t.n=4,Promise.all([re(),oe(),ue(r,"to"),ue(r,"cc")]);case 4:return a=t.v,i=e(a,4),c=i[0],s=i[1],u=i[2],l=i[3],p={plain:c,html:s,headers:{date:V(r),from:J(r),to:u,cc:l,subject:r.subject||"",message_id:D(r)}},t.p=5,t.n=6,fetch(ae("/api/v4/features/email/".concat(encodeURIComponent("K7BE"),"/classify/")),{method:"POST",headers:{"Content-Type":"application/json",Authorization:o},body:JSON.stringify(p)});case 6:if((g=t.v).ok){t.n=7;break}return m("sync failed (".concat(g.status,")")),t.a(2);case 7:return t.n=8,g.json();case 8:return b=t.v,m((h=(null==b?void 0:b.id)||(null==b||null===(v=b.metadata)||void 0===v?void 0:v.request_id)||"")?"sync ok (id: ".concat(h,")"):"sync ok"),t.n=9,_("InboxAgent synced","informationalMessage");case 9:t.n=11;break;case 10:t.p=10,A=t.v,console.error("InboxAgent sync failed",A),m("sync failed (network error)");case 11:return t.a(2)}},t,null,[[5,10]])}))).apply(this,arguments)}function de(){return pe.apply(this,arguments)}function pe(){return pe=a(n().m(function e(){var t,r,o,a,i,c,s,u,f,d,p=arguments;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=(p.length>0&&void 0!==p[0]?p[0]:{}).applyToForm,r=void 0!==t&&t,o=y()){e.n=1;break}return v("AI analysis not available."),g([]),e.a(2);case 1:return v("Analyzing..."),b("Analyzing..."),a=o.subject||"",e.n=2,re();case 2:return i=e.v,e.p=3,e.n=4,fetch("https://congress-library-prayer-international.trycloudflare.com/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:a,body:i,api_key:l})});case 4:if((c=e.v).ok){e.n=5;break}throw new Error("Analyze request failed (".concat(c.status,")"));case 5:return e.n=6,c.json();case 6:s=e.v,u=s.rationale||s.reply_suggestion||"No analysis returned.",f=h(s.actions&&Array.isArray(s.actions)&&s.actions.length?s.actions:s.reply_suggestion),v(u),g(f),r&&(k(s),m("analysis applied to attributes")),e.n=8;break;case 7:e.p=7,d=e.v,console.error("AI analysis failed",d),v("AI analysis failed."),g([]);case 8:return e.a(2)}},e,null,[[3,7]])})),pe.apply(this,arguments)}function ye(){return(ye=a(n().m(function e(){var t,r,o,a,i,c,s,u,f;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=y()){e.n=1;break}return m("ai reply not available"),e.a(2);case 1:return m("generating ai reply..."),r=t.subject||"",e.n=2,re();case 2:return o=e.v,e.p=3,e.n=4,fetch("".concat("https://congress-library-prayer-international.trycloudflare.com","/reply"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subject:r,body:o,tone:"professional",api_key:l})});case 4:if((i=e.v).ok){e.n=5;break}throw new Error("Reply request failed (".concat(i.status,")"));case 5:return e.n=6,i.json();case 6:if(c=e.v,s=c.reply_text||""){e.n=7;break}throw new Error("Empty reply from server");case 7:if(null===(a=t.body)||void 0===a||!a.setAsync){e.n=8;break}return u=I(s).replace(/\n/g,"<br>"),t.body.setAsync(u,{coercionType:Office.CoercionType.Html},function(e){e.status!==Office.AsyncResultStatus.Succeeded?m("ai reply insert failed"):m("ai reply inserted")}),e.a(2);case 8:if(!t.displayReplyForm){e.n=9;break}return t.displayReplyForm(s),m("ai reply draft opened"),e.a(2);case 9:m("ai reply not available"),e.n=11;break;case 10:e.p=10,f=e.v,console.error("AI reply failed",f),m("ai reply failed");case 11:return e.a(2)}},e,null,[[3,10]])}))).apply(this,arguments)}Office.onReady(function(){X(),function(){K.apply(this,arguments)}();var e=function(e,t){var n=document.getElementById(e);n&&n.addEventListener("click",t)};e("btnApply",function(){return function(){return te.apply(this,arguments)}()}),e("btnSync",function(){return function(){return fe.apply(this,arguments)}()}),e("btnGetEmails",function(){return function(){return le.apply(this,arguments)}()}),e("btnSnooze",function(){m("snoozed (demo)")}),e("btnRefresh",function(){X({preserveForm:!0,allowLocalFallback:!1,notify:!0})}),e("btnClear",function(){return function(){return ne.apply(this,arguments)}()}),e("btnWorkflow",function(){m("workflow started (demo)")}),e("btnAnalyze",function(){return de({applyToForm:!0})}),e("btnTemplate",function(){return function(){var e,t,n,r=null===(e=Office.context)||void 0===e?void 0:e.mailbox,o=E(),a=T((null===(t=document.getElementById("templateSelect"))||void 0===t?void 0:t.value)||"default",o);if(null!=r&&r.displayNewMessageForm)try{return r.displayNewMessageForm({htmlBody:a}),void m("new email opened")}catch(e){return console.error("New email create failed",e),void m("new email open failed")}var i=y();if(null!=i&&null!==(n=i.body)&&void 0!==n&&n.setAsync){var c=i.itemClass||"",s=function(e){if((null==e?void 0:e.status)!==Office.AsyncResultStatus.Succeeded){var t=(null==e?void 0:e.error)||new Error("Unable to insert template.");console.error("Template insert failed",t),m("template insert failed")}else m("template inserted")};Boolean(i.inReplyTo)||/reply|forward/i.test(c)?i.body.setAsync(a,{coercionType:Office.CoercionType.Html},s):i.body.appendAsync?i.body.appendAsync(a,{coercionType:Office.CoercionType.Html},s):i.body.setAsync(a,{coercionType:Office.CoercionType.Html},s)}else m("template insert not available")}()}),e("btnReplyTemplate",function(){return function(){var e,t=y();if(null!=t&&t.displayReplyForm){var n=E(),r=T((null===(e=document.getElementById("templateSelect"))||void 0===e?void 0:e.value)||"default",n);try{t.displayReplyForm(r),m("reply draft opened")}catch(e){console.error("Reply with template failed",e),m("reply template failed")}}else m("reply with template not available")}()}),e("btnReply",function(){return function(){return ye.apply(this,arguments)}()})})}();
//# sourceMappingURL=taskpane.js.map